'use strict';document.addEventListener("DOMContentLoaded",function(){function E(a){a.setToSetupPose();a.updateWorldTransform();let b=new spine.Vector2,d=new spine.Vector2;a.getBounds(b,d,[]);return{offset:b,size:d}}function A(){if(!$("#pause").is(":checked")){var a=h,b=Date.now()/1E3,d=b-w;w=b;b=c.clientWidth;var f=c.clientHeight;if(c.width!=b||c.height!=f)c.width=b,c.height=f;if(l){b=l.offset.x+l.size.x/2;f=l.offset.y+l.size.y/2;var e=Math.max(l.size.x/c.width,l.size.y/c.height)*2;e<1&&(e=1);var g=
c.width*e;e*=c.height;t.ortho2d(b-g/2,f-e/2,g,e);h.viewport(0,0,c.width,c.height)}a.clearColor(.3,.3,.3,1);a.clear(a.COLOR_BUFFER_BIT);r.update(d);r.apply(k);k.updateWorldTransform();p.bind();p.setUniformi(spine.webgl.Shader.SAMPLER,0);p.setUniform4x4f(spine.webgl.Shader.MVP_MATRIX,t.values);u.begin(p);a=$("#pma").is(":checked");x.premultipliedAlpha=a;x.draw(u,k);u.end();p.unbind();$("#debug").is(":checked")&&(debugShader.bind(),debugShader.setUniform4x4f(spine.webgl.Shader.MVP_MATRIX,t.values),m.premultipliedAlpha=
a,v.begin(debugShader),m.draw(v,k),v.end(),debugShader.unbind())}requestAnimationFrame(A)}const y=document.getElementById("drop-area"),F=document.getElementById("drop-text"),q=document.getElementById("file-list"),c=document.getElementById("myCanvas");let h,p,u,t=new spine.webgl.Matrix4,x,m,v,w,B,k,C,D,z,l,r;class G{constructor(){this.texture=this.atlas=this.json=null}add(a){a.name.endsWith(".json")?this.json=a:a.name.endsWith(".atlas")?this.atlas=a:a.name.endsWith(".png")&&(this.texture=a);this.json&&
this.atlas&&this.texture&&this.startLoad().finally();console.log("load:",a.name)}async startLoad(){console.log("\u6784\u5efa\u9aa8\u9abc\u6570\u636e");var a=await this.atlas.text();let b=await createImageBitmap(this.texture,{premultiplyAlpha:"none",colorSpaceConversion:"none"});a=new spine.TextureAtlas(a,()=>new spine.webgl.GLTexture(h,b));B.textureLoader(b);a=new spine.AtlasAttachmentLoader(a);a=new spine.SkeletonJson(a);a.scale=1;var d=JSON.parse(await this.json.text());a=a.readSkeletonData(d);
k=new spine.Skeleton(a);z=a.defeaultSkin?a.defeaultSkin.name:"default";C=a.skins.map(n=>n.name);D=a.animations.map(n=>n.name);a=$("#skins");a.empty();for(var f of C)d=$("<option></option>"),d.attr("value",f).text(f),f===z&&d.attr("selected","selected"),a.append(d);f=$("#animations");let e;f.empty();for(var g of D)d=$("<option></option>"),d.attr("value",g).text(g),g===z&&d.attr("selected","selected"),f.append(d),e||=g;g=new spine.AnimationStateData(k.data);l=E(k);r=new spine.AnimationState(g);r.setAnimation(0,
e,!0);a.change(()=>{k.setToSetupPose();let n=$("#skins option:selected").text();k.setSkinByName(n);k.setSlotsToSetupPose()});f.change(()=>{k.setToSetupPose();let n=$("#animations option:selected").text();r.setAnimation(0,n,!0)});w=Date.now()/1E3;requestAnimationFrame(A)}}(function(){y.addEventListener("dragover",function(b){b.preventDefault();b.stopPropagation();b.dataTransfer.dropEffect="copy"});y.addEventListener("drop",function(b){b.preventDefault();b.stopPropagation();console.log(b.dataTransfer.files);
const d=new G;for(;q.firstChild;)q.removeChild(q.firstChild);q.style.display="block";F.style.display="none";y.style.justifyContent="end";b=b.dataTransfer.files;for(let f=0;f<b.length;f++){const e=b[f],g=document.createElement("li");g.textContent=e.name;e.type?["image/png","application/json"].includes(e.type)&&(d.add(e),q.appendChild(g)):e.name.endsWith(".atlas")&&(d.add(e),q.appendChild(g))}});c.width=window.innerWidth;c.height=window.innerHeight;var a={alpha:!1};(h=c.getContext("webgl",a)||c.getContext("experimental-webgl",
a))?(p=spine.webgl.Shader.newTwoColoredTextured(h),u=new spine.webgl.PolygonBatcher(h),t.ortho2d(0,0,c.width-1,c.height-1),x=new spine.webgl.SkeletonRenderer(h),B=new spine.webgl.AssetManager(h),m=new spine.webgl.SkeletonDebugRenderer(h),m.drawRegionAttachments=!0,m.drawBoundingBoxes=!0,m.drawMeshHull=!0,m.drawMeshTriangles=!0,m.drawPaths=!0,debugShader=spine.webgl.Shader.newColored(h),v=new spine.webgl.ShapeRenderer(h),a=h,a.clearColor(.3,.3,.3,1),a.clear(a.COLOR_BUFFER_BIT)):alert("WebGL is unavailable.")})()});